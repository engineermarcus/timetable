<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Title and Description -->
    <title>Timetable</title>
    <meta property="og:title" content="Timetable">
    <meta property="og:description" content="This is a cool web app!">
    <meta property="og:image" content="thumbnail.jpg">
    <meta property="og:image:type" content="image/jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="https://timestamp-nc0c.onrender.com/">
    <meta property="og:type" content="website">
    <meta name="description" content="A simple admin dashboard to manage your timetable easily.">
    
    <!-- Keywords (Optional, but not very effective for SEO anymore) -->
    <meta name="keywords" content="admin dashboard, timetable management, schedule planner">
    
    <!-- Author -->
    <meta name="author" content="Marcus Onyango">
    
    <!-- Viewport for Mobile Responsiveness -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta property="og:title" content="Timetable">
    <meta property="og:description" content="Easily manage your schedule with our timetable admin panel.">
    <meta property="og:image" content="https://timestamp-nc0c.onrender.com/thumbnail.jpg">
    <meta property="og:image:type" content="image/png">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:url" content="https://timestamp-nc0c.onrender.com/">
    <meta property="og:type" content="website">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/public/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
    <div id="docs" class="max-w-5xl mx-auto bg-white shadow-md rounded-lg p-6">
        <h1 class="text-2xl font-bold mb-4 text-gray-700">EIC/600/M24</h1>

        <!-- Timetable Table -->
        <table  class="w-full border-collapse border border-gray-300">
            <thead>
                <tr class="bg-gray-200">
                    <th class="border border-gray-300 p-2">Day</th>
                    <th class="border border-gray-300 p-2">Time</th>
                    <th class="border border-gray-300 p-2">Lesson</th>
                </tr>
            </thead>
          <tbody>
              <% let groupedTimetable = {}; %>
              <% 
                  // Group lessons by day
                  timetable.forEach(row => {
                      if (!groupedTimetable[row.day]) {
                          groupedTimetable[row.day] = [];
                      }
                      groupedTimetable[row.day].push(row);
                  });
          
                  // Iterate through sorted days
                  Object.keys(groupedTimetable).forEach(day => {
                      let lessons = groupedTimetable[day];
          
                      // Sort lessons by start time
                      lessons.sort((a, b) => new Date(`1970-01-01T${a.time.split(' - ')[0]}`) - new Date(`1970-01-01T${b.time.split(' - ')[0]}`));
              %>
                  <tr class="text-center border border-gray-300">
                      <!-- Day Cell -->
                      <td class="border border-gray-300 p-2 font-semibold bg-gray-100 align-top" rowspan="<%= lessons.length %>">
                          <%= day %>
                      </td>
                      <!-- First Lesson -->
                      <td class="border border-gray-300 p-2"><%= lessons[0].time %></td>
                      <td class="border border-gray-300 p-2"><%= lessons[0].lesson %></td>
                  </tr>
          
                  <% for (let i = 1; i < lessons.length; i++) { %>
                  <tr class="text-center border border-gray-300">
                      <td class="border border-gray-300 p-2"><%= lessons[i].time %></td>
                      <td class="border border-gray-300 p-2"><%= lessons[i].lesson %></td>
                  </tr>
                  <% } %>
              <% }) %>
          </tbody>
        </table>
    </div>
    <div class="text-right mb-4">
        <a href="/admin/login" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">
            Login as Admin
        </a>
    </div>
    <button id="downloadPDF" class="bg-orange-600 text-white px-4 py-2 rounded hover:bg-green-700">
        Download PDF
    </button>

    
     <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
     
     <script>
     document.getElementById('downloadPDF').addEventListener('click', function() {
     var element = document.getElementById('docs'); // Get the table
     html2pdf(element); // Convert the table to PDF
     });
     </script>
     <script type="application/ld+json">
     {
       "@context": "https://schema.org",
       "@type": "WebApplication",
       "name": "Admin Dashboard",
       "description": "A simple admin dashboard to manage your timetable easily.",
       "url": "https://timestamp-nc0c.onrender.com/",
       "image": "https://https://timestamp-nc0c.onrender.com/thumbnail.jpg",
       "author": {
         "@type": "Person",
         "name": "Marcus Onyango"
       }
     }
     </script>
   
</body>
</html>
