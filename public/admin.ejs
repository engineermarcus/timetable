<!DOCTYPE html>
<html>
<head>
    <title>Admin Dashboard</title>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.getElementById("editBtn").addEventListener("click", function () {
                document.querySelectorAll(".row-checkbox:checked").forEach(checkbox => {
                    let row = checkbox.closest("tr");
                    row.querySelectorAll(".editable").forEach(cell => {
                        let text = cell.innerText.trim();
                        let input = document.createElement("input");
                        input.type = "text";
                        input.value = text;
                        input.classList.add("edit-input");
                        cell.innerText = "";
                        cell.appendChild(input);
                    });
                });
            });

            document.getElementById("saveBtn").addEventListener("click", function () {
                document.querySelectorAll(".row-checkbox:checked").forEach(checkbox => {
                    let row = checkbox.closest("tr");
                    let id = row.getAttribute("data-id");
                    let updatedData = {};

                    row.querySelectorAll(".editable").forEach(cell => {
                        let input = cell.querySelector("input");
                        if (input) {
                            updatedData[cell.getAttribute("data-field")] = input.value;
                            cell.innerText = input.value;
                        }
                    });

                    // Send update request
                    fetch(`/admin/update/${id}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(updatedData)
                    })
                    .then(response => response.json())
                    .then(data => {
                        if (!data.success) {
                            alert("Error updating data!");
                        }
                    })
                    .catch(err => console.error("Error:", err));
                });
            });
        });
    </script>
</head>
<body>
    <h1>Manage Timetable</h1>
    <form action="/admin/add" method="POST">
        <input type="text" name="day" placeholder="Day">
        <input type="text" name="time" placeholder="Time">
        <input type="text" name="lesson" placeholder="Lesson">
        <button type="submit">Add Lesson</button>
    </form>

    <table border="1">
        <tr>
            <th>Select</th>
            <th>Day</th>
            <th>Time</th>
            <th>Lesson</th>
        </tr>
        <% timetable.forEach(row => { %>
        <tr data-id="<%= row._id %>">
            <td><input type="checkbox" class="row-checkbox"></td>
            <td class="editable" data-field="day"><%= row.day %></td>
            <td class="editable" data-field="time"><%= row.time %></td>
            <td class="editable" data-field="lesson"><%= row.lesson %></td>
        </tr>
        <% }); %>
    </table>

    <button id="editBtn">Edit</button>
    <button id="saveBtn">Save</button>

    <a href="/admin/logout">Logout</a>
</body>
</html>
